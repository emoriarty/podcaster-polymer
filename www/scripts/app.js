!function(e){"use strict";function t(t){if(t){var n=e.getElementById("feedLoader");y.podcasts&&_.findWhere(y.podcasts,{feedUrl:t})||(n.feed=t)}}function n(t){var n=t.detail.feed,r=e.querySelector("iron-localstorage[name=podcasts]");y.podcasts||(y.podcasts=[]),y.podcasts.push(n),n.entries.forEach(a),o(n),r.value=y.podcasts,r.save(),r.reload()}function r(e){var t=e.detail.feed;t&&(t.entries.forEach(u),y.podcastTrends=t.entries)}function o(e){var t,n,r=e.xmlDocument.querySelector("channel > image"),o=e.xmlDocument.querySelector("language"),a=e.xmlDocument.querySelector("subtitle"),u=e.xmlDocument.querySelector("category");if(r&&r.getAttribute("href")&&(e.cover=r.getAttribute("href")),o&&o.textContent){var c=o.textContent.split("-");e.language=c[0],e.country=c[1]}return a&&a.textContent&&(e.descriptionSnippet=a.textContent),u&&u.getAttribute("text")&&(e.category=u.getAttribute("text")),e.description||(t=e.xmlDocument.querySelector("summary"),t&&t.textContent&&(e.description=t.textContent)),e.author||(n=e.xmlDocument.querySelector("author"),n&&n.textContent&&(e.author=n.textContent)),delete e.xmlDocument,e}function a(e,t){var n,r,o,a,u=e.xmlNode.querySelector("enclosure"),c=e.xmlNode.querySelector("image");return u&&(e.track=u.getAttribute("url")),c&&(e.cover=c.getAttribute("href")),e.content||(n=e.xmlNode.querySelector("summary"),n&&(e.content=n.textContent)),e.contentSnippet||(r=e.xmlNode.querySelector("subtitle"),r&&(e.contentSnippet=r.textContent)),e.author||(o=e.xmlNode.querySelector("author"),o&&(e.author=o.textContent)),e.duration||(a=e.xmlNode.querySelector("duration"),a&&(e.duration=a.textContent)),e.podcastIndex=t,delete e.xmlNode,e}function u(e){var t=e.xmlNode.querySelectorAll("image"),n=e.xmlNode.querySelector("category"),r=e.link.match(/id(\d+)/);if(t){var o=_.reduce(t,function(e,t){return parseInt(t.getAttribute("height"))>parseInt(e.getAttribute("height"))?t:e});e.cover=o.textContent}return n&&(e.category=n.getAttribute("label")),r&&r.length>1&&(e.lookupId=r[1]),e}function c(e){l(),d(e)}function l(){YUI().use("yql",function(e){e.YQL("select * from html where url='https://rss.itunes.apple.com/data/media-types.json'",function(e){g=JSON.parse(e.query.results.body),g=_.findWhere(g,{store:"podcast"}),console.log("PODCAST_TYPES",g)})})}function d(e){YUI().use("yql",function(t){t.YQL("select * from html where url='https://rss.itunes.apple.com/data/countries.json'",function(t){p=JSON.parse(t.query.results.body),p=_.inject(p,function(e,t){return t.stores.podcast&&e.push(t),e},[]),console.log("COUNTRIES",p),e&&e()})})}function s(e){e=e||"en-US",YUI().use("yql",function(t){t.YQL("select * from html where url='https://rss.itunes.apple.com/data/lang/"+e+"/common.json'",function(e){f=JSON.parse(e.query.results.body),console.log("COMMON_TRANSLATIONS",f),f.countries=Object.keys(f.feed_country).map(function(e,t){return e===y.countryCode&&(console.log(e,t),y.selectedCountry=t),{code:e,name:f.feed_country[e]}}),y.commonTranslations=f}),t.YQL("select * from html where url='https://rss.itunes.apple.com/data/lang/"+e+"/media-types.json'",function(e){m=JSON.parse(e.query.results.body),console.log("MEDIA_TRANSLATIONS",m),m.subgenres=_.map(g.subgenres,function(e){return{name:m[e.translation_key],id:e.id}}),y.mediaTranslations=m})})}function i(e){e=e||{};var t=g.feed_types[0].urlPrefix.replace("<%= country_code %>",y.countryCode),n="limit="+(e.limit||25)+"/";return e.genre&&e.genre.length>0&&(n=n.concat("genre=",e.genre,"/")),t.replace("<%= parameters %>",n)+g.feed_types[0].urlSuffix}var g,p,y=e.querySelector("#app"),f={},m={};window.addEventListener("WebComponentsReady",function(){}),y.addEventListener("dom-change",function(){var t=e.getElementById("feedLoader"),o=e.getElementById("feedTrends");c(function(){var t=e.querySelector("iron-localstorage[name=settings]"),n=t.value,r=_.findWhere(p,{country_code:n.countryCode});y.countryCode=n.countryCode,r&&s(r.language)}),y.currentEntry=!1,y.podcastTrends=!1,t.addEventListener("google-feeds-response",n),o.addEventListener("google-feeds-response",r)}),y.addPodcast=function(){t(e.querySelector("#addPodcastDlg input").value)},y.addTrendPodcast=function(t){var n=t.currentTarget.parentNode.parentNode.parentNode.querySelector("[name=lookupId]").value,r=e.querySelector("byutv-jsonp#lookup");n&&r&&(r.params={id:n},r.generateRequest())},y.checkPodcasts=function(e){console.log("load empty",e)},y.checkSettings=function(e){var t=navigator.language.split("-"),n=2===t.length?t[1].toLowerCase():"us",r=e.currentTarget;_.findWhere(p,{country_code:n})?r.value={countryCode:n}:r.value={countryCode:"us"},r.save(),r.reload()},y.showEntries=function(e){var t=e.currentTarget.querySelector("input[name=podcast-id]");t&&t.value&&Excess.RouteManager.transitionTo("/podcast/"+t.value)},y.showAddPodcastDialog=function(){var t=e.getElementById("addPodcastDlg");t.open()},y.showSettings=function(){var t=e.getElementById("settingsDlg");t.open()},y.play=function(t){if(t.detail&&t.detail.track){var n=t.detail,r=e.querySelector("podcaster-player");y.currentTarget&&y.currentTarget!==t.currentTarget&&y.currentTarget.playing(!1),n.playing||(y.currentTarget=t.currentTarget,y.currentEntry=n),r.play()}else console.log("no track to play!")},y.pause=function(t){if(t.detail){var n=e.querySelector("podcaster-player");t.detail.playing=!1,n.pause()}},y.handlePlay=function(){var t=e.querySelector("podcaster-panel");t.show(),y.currentTarget&&y.currentTarget.playing(!0)},y.handlePause=function(e){e.detail.title===y.currentEntry.title&&y.currentTarget.playing(!1)},y.handlePlayerError=function(){y.currentTarget&&(y.currentTarget.playing(!1),y.currentTarget.loading(!1))},y.handleOpenedPanel=function(t){var n=e.querySelector("podcaster-player");if(n.audio.title===y.currentEntry.title){var r=e.querySelector("#mainContainer");r.style.paddingBottom=t.detail.offsetHeight+"px"}},y.handleTrends=function(e){y.podcastTrends=e.detail.feed},y.handleLookup=function(e){var n=e.detail.results;1===n.length&&t(n[0].feedUrl)},y.handleSubroute=function(t){var n=e.getElementById("feedTrends");switch(t.detail.name){case"trends":y.currentTab=1,n.feed=i();break;default:y.currentTab=0}},y.handleGenre=function(t){var n=e.getElementById("feedTrends");n.feed=i({genre:t.detail.item.id})},y.handleCountry=function(t){var n=e.querySelector("iron-localstorage[name=settings]"),r=n.value;r.countryCode!==t.detail.item.id&&(r.countryCode=t.detail.item.id,n.value=r,n.save(),n.reload(),location.href=location.origin)},window.onbeforeunload=function(){var t=e.querySelector("iron-localstorage[name=podcasts]");t.save()}}(document);